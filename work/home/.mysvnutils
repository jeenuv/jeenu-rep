#!/bin/bash

# To list all SVN modified items in the given directory
function svnmodified()
{
    svn st $@ -q | awk '/^M/{print $2}'
}

# Recursively show diffs for all the modified files
function svnshowdiffs()
{
    local i
    local svn_patch_file="$HOME/tmp/svnpatchfile"

    for i in $(svnmodified $@); do
        # prompt for continue
        REPLY= read -n1 -p "$i: continue (n/q)? "
        if [ "$REPLY" = "n" -o "$REPLY" = "N" ]; then
            echo
            continue
        elif [ "$REPLY" = "q" -o "$REPLY" = "Q" ]; then
            echo
            return
        fi

        echo " getting diff..."
        svn diff "$i" > "$svn_patch_file" || continue

        if [ "$(stat -c %s "$svn_patch_file")" -eq 0 ]; then
            echo "svnshowdiffs: $i: no diff found"
            continue
        else
            vim -n '+set patchexpr=MyPatch()' \
                   "+leftabove vertical diffpatch $svn_patch_file |cmap q qa|nmap <F7> ]c|nmap <F6> [c|windo set fdm=diff|normal gg" \
            "$i"
        fi
    done
}

# Function to get the repository URL
function svngetrep()
{
    svn info $@ | awk '/URL:/{print $2}'
}

# Function to get the repository root
function svngetreproot()
{
    svn info $@ | awk '/Root:/{print $3}'
}
